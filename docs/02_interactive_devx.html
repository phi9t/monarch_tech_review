<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/favicon.ico" />
    <!-- Preload is necessary because we show these images when we disconnect from the server,
    but at that point we cannot load these images from the server -->
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/gradient-yHQUC_QB.png" as="image" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/noise-60BoTA8O.png" as="image" />
    <!-- Preload the fonts -->
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/Lora-VariableFont_wght-B2ootaw-.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/PTSans-Regular-CxL0S8W7.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/PTSans-Bold-D9fedIX3.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/FiraMono-Regular-BTCkDNvf.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/FiraMono-Medium-DU3aDxX5.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/FiraMono-Bold-CLVRCuM9.ttf" as="font" crossorigin="anonymous" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="a marimo app" />
    <link rel="apple-touch-icon" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/apple-touch-icon.png" />
    <link rel="manifest" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/manifest.json" />

    <script data-marimo="true">
      function __resizeIframe(obj) {
        const scrollbarHeight = 20; // Max between windows, mac, and linux

        function setHeight() {
          // Guard against race condition where iframe isn't ready
          if (!obj.contentWindow?.document?.documentElement) {
            return;
          }
          const element = obj.contentWindow.document.documentElement;
          // If there is no vertical scrollbar, we don't need to resize the iframe
          if (element.scrollHeight === element.clientHeight) {
            return;
          }

          // Create a new height that includes the scrollbar height if it's visible
          const hasHorizontalScrollbar = element.scrollWidth > element.clientWidth;
          const newHeight = element.scrollHeight + (hasHorizontalScrollbar ? scrollbarHeight : 0);

          // Only update the height if it's different from the current height
          if (obj.style.height !== `${newHeight}px`) {
            obj.style.height = `${newHeight}px`;
          }
        }

        // Resize the iframe to the height of the content and bottom scrollbar height
        setHeight();

        // Resize the iframe when the content changes
        const resizeObserver = new ResizeObserver((_entries) => {
          setHeight();
        });
        // Only observe if iframe content is ready
        if (obj.contentWindow?.document?.body) {
          resizeObserver.observe(obj.contentWindow.document.body);
        }
      }
    </script>
    <marimo-filename hidden>02_interactive_devx.py</marimo-filename>
    <!-- TODO(Trevor): Legacy, required by VS Code plugin. Remove when plugin is updated (see marimo/server/_templates/template.py) -->
    <marimo-version data-version="{{ version }}" hidden></marimo-version>
    <marimo-user-config data-config="{{ user_config }}" hidden></marimo-user-config>
    <marimo-server-token data-token="{{ server_token }}" hidden></marimo-server-token>
    <!-- /TODO -->
    <title>02 interactive devx</title>
    <script type="module" crossorigin crossorigin="anonymous" src="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/index-DGasP9Lh.js"></script>
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/preload-helper-DItdS47A.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/clsx-D8GwTfvk.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/cn-BKtXLv3a.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/chunk-LvLJmgfZ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/react-BGmjiNul.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/compiler-runtime-DeeZ7FnK.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/jsx-runtime-ZmTK25f3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/badge-Ce8wRjuQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/hotkeys-BHHWjLlp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/useEventListener-DIUKKfEy.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/button-YC1gW_kJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/react-dom-C9fstfnp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/Combination-CMPwuAmi.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/menu-items-CJhvWPOk.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/dist-uzvC4uAK.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/createLucideIcon-CnW3RofX.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/check-DdfN0k2d.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/select-V5IdpNiR.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/tooltip-CEc2ajau.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/use-toast-rmUWldD_.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/_Uint8Array-BGESiCQL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/_baseIsEqual-B9N9Mw_N.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/useEvent-DO6uJBas.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/invariant-CAG_dYON.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/_baseFor-Duhs3RiJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/merge-BBX6ug-N.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/zod-Cg4WLWh2.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/utils-DXvhzCGS.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/constants-B6Cb__3x.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/Deferred-CrO5-0RA.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/config-CIrPQIbt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/uuid-DercMavo.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/DeferredRequestRegistry-CO2AyNfd.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/requests-BsVD4CdD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/isSymbol-BGkTcW3U.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/toString-DlRqgfqz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/_hasUnicode-CWqKLxBC.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/assertNever-CBU83Y6o.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/_arrayReduce-TT0iOGKY.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/useLifecycle-D35CBukS.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/useNonce-_Aax6sXd.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/useTheme-DUdVAZI8.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/once-Bul8mtFs.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/capabilities-MM7JYRxj.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/createReducer-Dnna-AUO.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/dist-DBwNzi3C.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/dist-ChS0Dc_R.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/dist-CtsanegT.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/dist-BIKFl48f.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/dist-B0VqT_4z.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/dist-TiFCI16_.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/dist-Cayq-K1c.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/dist-BYyu59D8.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/dist-Gqv0jSNr.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/stex-CtmkcLz7.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/toDate-CgbKQM5E.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/cjs-CH5Rj0g8.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/_baseProperty-NKyJO2oh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/now-6sUe0ZdD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/debounce-B3mjKxHe.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/toInteger-CDcO32Gx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/database-zap-B9y7063w.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/main-U5Goe76G.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/cells-BpZ7g6ok.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/spinner-DaIKav-i.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/chevron-right-DwagBitu.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/dropdown-menu-B-6unW-7.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/kbd-C3JY7O_u.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/renderShortcut-DEwfrKeS.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/multi-map-C8GlnP-4.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/alert-BrGyZf9c.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/alert-dialog-DwQffb13.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/dialog-CxGKN4C_.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/dist-CdxIjAOP.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/label-Be1daUcS.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/useDebounce-D5NcotGm.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/textarea-DBO30D7K.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/numbers-iQunIAXf.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/SSRProvider-CEHRCdjA.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/context-JwD-oSsl.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/useNumberFormatter-c6GXymzg.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/usePress-Bup4EGrp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/input-pAun1m1X.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/links-DHZUhGz-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/popover-Gz-GJzym.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/switch-8sn_4qbh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/table-C8uQmBAN.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/mode-DX8pdI-l.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/useAsyncData-C4XRy1BE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/errors-2SszdW9t.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/error-banner-DUzsIXtq.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/copy-Bv2DBpIS.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/memoize-BCOZVFBt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/get-6uJrSKbw.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/capitalize-CmNnkG9y.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/copy-CQ15EONK.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/plus-BD5o34_i.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/refresh-cw-CQd-1kjx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/trash-2-CyqGun26.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/triangle-alert-B65rDESJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/ai-model-dropdown-71lgLrLy.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/defaultLocale-D_rSvXvJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/precisionRound-BMPhtTJQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/defaultLocale-C92Rrpmf.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/vega-loader.browser-CRZ52CKf.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/tooltip-BGrCWNss.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/ErrorBoundary-ChCiwl15.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/useInstallPackage-Bdnnp5fe.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/ImperativeModal-CUbWEBci.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/cell-link-Bw5bzt4a.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/datasource-B0OJBphG.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/state-BfXVTTtD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/MarimoErrorOutput-5rudBbo3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/copy-icon-BhONVREY.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/html-to-image-DjukyIj4.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/focus-D51fcwZX.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/LazyAnyLanguageCodeMirror-yzHjsVJt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/chunk-5FQGJX7Z-CVUXBqX6.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/katex-Dc8yG8NU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/markdown-renderer-DhMlG2dP.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/command-DhzFN2CJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/download-BhCZMKuQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/useRunCells-24p6hn99.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/purify.es-DNVQZNFu.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/RenderHTML-CQZqVk1Z.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/useIframeCapabilities-DuIDx9mD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/formats-W1SWxSE3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/en-US-pRRbZZHE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/isValid-DcYggVWP.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/dates-Dhn1r-h6.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/maps-t9yNKYA8.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/extends-B2LJnKU3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/emotion-is-prop-valid.esm-DD4AwVTU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/useDateFormatter-CS4kbWl2.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/range-D2UKkEg-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/table-DZR6ewbN.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/JsonOutput-CknFTI_u.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/file-Cs1JbsV6.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/play-BPIh-ZEU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/chat-components-CGlO4yUw.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/isEmpty-CgX_-6Mt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/chat-display-B4mGvJ0X.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/useDeleteCell-5uYlTcQZ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/icons-BhEXrzsb.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/process-output-CagdHMzs.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/blob-CuXvdYPX.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/objectWithoutPropertiesLoose-DaPAPabU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/esm-DpMp6qko.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/add-cell-with-ai-pVFp5LZG.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/chart-no-axes-column-W42b2ZIs.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/square-function-CqXXKtIq.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/spec-D1kBp3jX.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/column-preview-CxMrs0B_.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/toggle-jWKnIArU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/globals-DKH14XH0.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/share-CbPtIlnM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/_baseSet-5Rdwpmr3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/react-resizable-panels.browser.esm-Ctj_10o2.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/utilities.esm-CIPARd6-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/floating-outline-DcxjrFFt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/useAddCell-BmeZUK02.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/eye-off-BhExYOph.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/readonly-python-code-DyP9LVLc.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/file-video-camera-DW3v07j2.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/types-DuQOSW7G.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/refresh-ccw-DLEiQDS3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/form-DUA_Rz_a.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/field-BEg1eC0P.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/useBoolean-B1Xeh6vA.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/useDeepCompareMemoize-ZPd9PxYl.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/types-CS34eOZi.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/prop-types-BiQYf0aU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/es-D8BOePqo.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/hasIn-CycJImp8.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/_baseFlatten-CUZNxU8H.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/flatten-D-7VEN0q.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/pick-B_6Qi5aM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/code-xml-XLwHyDBr.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/download-B9SUL40m.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/house-DhFkiXz7.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/settings-DOXWMfVd.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/square-C8Tw_XXG.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/bundle.esm-2AjO7UK5.js">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/cells-jmgGt1lS.css">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/markdown-renderer-DdDKmWlR.css">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/JsonOutput-B7vuddcd.css">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.19.7/dist/assets/index-CikhHYAB.css">
  
<script data-marimo="true">
    window.__MARIMO_STATIC__ = {};
    window.__MARIMO_STATIC__.files = {};
</script>
</head>
  <body>
    <div id="root"></div>
    <!-- This is a portal for the data editor to render in -->
    <div id="portal" data-testid="glide-portal" style="position: fixed; left: 0; top: 0; z-index: 9999"></div>
    <script data-marimo="true">
      window.__MARIMO_MOUNT_CONFIG__ = {
            "filename": "02_interactive_devx.py",
            "mode": "read",
            "version": "0.19.7",
            "serverToken": "static",
            "config": {"ai": {"custom_providers": {}, "models": {"custom_models": [], "displayed_models": []}}, "completion": {"activate_on_typing": true, "copilot": false, "signature_hint_on_typing": false}, "diagnostics": {"sql_linter": true}, "display": {"cell_output": "below", "code_editor_font_size": 14, "dataframes": "rich", "default_table_max_columns": 50, "default_table_page_size": 10, "default_width": "medium", "reference_highlighting": true, "theme": "light"}, "formatting": {"line_length": 79}, "keymap": {"overrides": {}, "preset": "default"}, "language_servers": {"pylsp": {"enable_flake8": false, "enable_mypy": true, "enable_pydocstyle": false, "enable_pyflakes": false, "enable_pylint": false, "enable_ruff": true, "enabled": false}}, "mcp": {"mcpServers": {}, "presets": []}, "package_management": {"manager": "uv"}, "runtime": {"auto_instantiate": false, "auto_reload": "off", "default_csv_encoding": "utf-8", "default_sql_output": "auto", "on_cell_change": "autorun", "output_max_bytes": 8000000, "reactive_tests": true, "std_stream_max_bytes": 1000000, "watcher_on_save": "lazy"}, "save": {"autosave": "after_delay", "autosave_delay": 1000, "format_on_save": false}, "server": {"browser": "default", "follow_symlink": false}, "snippets": {"custom_paths": [], "include_default_snippets": true}},
            "configOverrides": {},
            "appConfig": {"sql_output": "auto", "width": "medium"},
            "view": {"showAppCode": true},
            "notebook": {"cells": [{"code": "import marimo as mo", "code_hash": "1d0db38904205bec4d6f6f6a1f6cec3e", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Hbol", "name": "_"}, {"code": "# Shared imports for the notebook\nimport sys\nimport torch\nfrom monarch.actor import Actor, endpoint, current_rank, this_host", "code_hash": "63abb5b605f7bd4eaf3c855c8ec14f10", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "MJUe", "name": "_"}, {"code": "mo.md(r\"\"\"\n# Interactive DevX: Monarch as Remote Torchrun\n\nWhat you'll learn:\n\n1. The pain of traditional distributed development (sbatch \u2192 wait \u2192 debug \u2192 repeat)\n2. SPMDJob as \"remote torchrun\" - allocate once, iterate fast\n3. The three-layer stack: Boot \u2192 Coordination \u2192 Application\n4. Running distributed programs interactively with `this_host()`\n\"\"\")", "code_hash": "a1e87fbb5d6c400a44e7d1a656e32dcc", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "vblA", "name": "_"}, {"code": "mo.md(r\"\"\"\n## The Pain of Traditional Development\n\n```\nTraditional Distributed Development Loop:\n\nDeveloper                    SLURM                     Cluster\n    \u2502                          \u2502                          \u2502\n    \u251c\u2500\u2500 sbatch job.sh \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502                          \u2502\n    \u2502                          \u251c\u2500\u2500 queue... \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\n    \u2502                          \u2502   (minutes to hours)     \u2502\n    \u2502                          \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n    \u2502\u25c4\u2500\u2500 job started \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524                          \u2502\n    \u2502                          \u2502                          \u2502\n    \u2502   ...wait for completion...                         \u2502\n    \u2502                          \u2502                          \u2502\n    \u251c\u2500\u2500 cat slurm-*.out \u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502                          \u2502\n    \u2502\u25c4\u2500\u2500 scattered logs \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524                          \u2502\n    \u2502                          \u2502                          \u2502\n    \u2502   \"Found bug on line 42\"                            \u2502\n    \u2502                          \u2502                          \u2502\n    \u2514\u2500\u2500 sbatch again... \u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502   (repeat forever)       \u2502\n```\n\n**Key problems:**\n\n- Queue wait time dominates iteration time\n- Logs scattered across nodes\n- Each fix requires full resubmission\n- No interactive debugging\n\"\"\")", "code_hash": "9169ca43ef6104f4fd6d2a54b9bc768a", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "bkHC", "name": "_"}, {"code": "mo.md(r\"\"\"\n## The Monarch Solution\n\n```\nMonarch Development Loop:\n\nDeveloper                    Monarch                   Cluster\n    \u2502                          \u2502                          \u2502\n    \u251c\u2500\u2500 allocate hosts \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502                          \u2502\n    \u2502   (one time, slow)       \u251c\u2500\u2500 gang schedule \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\n    \u2502                          \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n    \u2502\u25c4\u2500\u2500 HostMesh ready \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524                          \u2502\n    \u2502                          \u2502                          \u2502\n    \u2502   === Fast iteration loop ===                       \u2502\n    \u2502                          \u2502                          \u2502\n    \u251c\u2500\u2500 spawn_procs() \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502   (instant)              \u2502\n    \u251c\u2500\u2500 spawn actors \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502   (instant)              \u2502\n    \u251c\u2500\u2500 call endpoints \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502   (instant)              \u2502\n    \u2502\u25c4\u2500\u2500 aggregated logs \u2500\u2500\u2500\u2500\u2500\u2500\u2524                          \u2502\n    \u2502                          \u2502                          \u2502\n    \u2502   \"Found bug, fixing...\"                            \u2502\n    \u2502                          \u2502                          \u2502\n    \u251c\u2500\u2500 spawn_procs() again \u2500\u2500\u25ba\u2502   (instant, same hosts!) \u2502\n    \u2514\u2500\u2500 ...                    \u2502                          \u2502\n```\n\n**Key insight:** Allocation is slow, but spawning on existing hosts is fast.\n\"\"\")", "code_hash": "4465359d2dedfe2494b1b2a3dc810353", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "lEQa", "name": "_"}, {"code": "mo.md(r\"\"\"\n## What's Really Happening Under the Hood\n\nWhen you call `SlurmJob(meshes={\"trainers\": 4}).apply()`, here's what actually happens:\n\n```\n1. Job Submission: Monarch submits an sbatch script to SLURM\n   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n   \u2502  #!/bin/bash                                               \u2502\n   \u2502  #SBATCH --nodes=4                                         \u2502\n   \u2502  srun python -c 'from monarch.actor import                 \u2502\n   \u2502       run_worker_loop_forever;                             \u2502\n   \u2502       run_worker_loop_forever(                             \u2502\n   \u2502           address=\"tcp://$(hostname):22222\",               \u2502\n   \u2502           ca=\"trust_all_connections\")'                     \u2502\n   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n2. Worker Startup: Each node runs run_worker_loop_forever\n   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n   \u2502  Node 0  \u2502  \u2502  Node 1  \u2502  \u2502  Node 2  \u2502  \u2502  Node 3  \u2502\n   \u2502  :22222  \u2502  \u2502  :22222  \u2502  \u2502  :22222  \u2502  \u2502  :22222  \u2502\n   \u2502 waiting  \u2502  \u2502 waiting  \u2502  \u2502 waiting  \u2502  \u2502 waiting  \u2502\n   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n3. Client Connection: job.state() calls attach_to_workers(...)\n   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n   \u2502  Your notebook / script                                 \u2502\n   \u2502                                                         \u2502\n   \u2502  host_mesh = attach_to_workers(                         \u2502\n   \u2502      workers=[\"tcp://node0:22222\", \"tcp://node1:22222\", \u2502\n   \u2502               \"tcp://node2:22222\", \"tcp://node3:22222\"],\u2502\n   \u2502      ca=\"trust_all_connections\"                         \u2502\n   \u2502  )                                                      \u2502\n   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n```\n\n**The key insight: Workers are just servers waiting for work.**\n\nThe scheduler (SLURM, Kubernetes, etc.) handles launching them.\nThe client (your notebook/script) connects and orchestrates.\n\"\"\")", "code_hash": "8507148544e6f8be1281603b8caad3d2", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "PKri", "name": "_"}, {"code": "mo.md(r\"\"\"\n### Live Demo: Workers as Servers\n\nLet's see this in action. We'll use `create_local_host_mesh` which spawns\nworker processes locally - exactly what SlurmJob does on a real cluster.\n\"\"\")", "code_hash": "364404bf96b00883fe029e381c4416c2", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Xref", "name": "_"}, {"code": "from monarch._src.actor.host_mesh import create_local_host_mesh\nfrom monarch._src.actor.endpoint import Extent\n\nclass BootstrapDemo(Actor):\n    \"\"\"Actor that reports where it's running.\"\"\"\n\n    def __init__(self):\n        self.rank = current_rank().rank\n        print(f\"[BootstrapDemo] Actor initialized on rank {self.rank}\")\n\n    @endpoint\n    def whoami(self) -\u003E dict:\n        return {\"rank\": self.rank, \"python\": sys.executable}\n\n# This simulates what SlurmJob does:\n# 1. Spawn worker processes (like run_worker_loop_forever on each node)\n# 2. Connect to them (like attach_to_workers)\n# 3. Return a HostMesh\nprint(\"Creating host mesh with 3 workers...\")\ndemo_host_mesh = create_local_host_mesh(\n    extent=Extent([\"hosts\"], [3]),\n    env={\"PYTHONPATH\": \":\".join(sys.path)},\n)\nprint(\"Host mesh created - workers are now listening!\\n\")\n\n# Spawn processes and actors\ndemo_procs = demo_host_mesh.spawn_procs(per_host={\"gpus\": 1})\ndemo_actors = demo_procs.spawn(\"bootstrap_demo\", BootstrapDemo)\n\n# Call all actors\nprint(\"\\nCalling whoami() on all actors:\")\ndemo_results = demo_actors.whoami.call().get()\nfor point, info in demo_results.items():\n    print(f\"  {point}: rank={info['rank']}\")", "code_hash": "c5ba37c58eb339ddc316a4daacfc97e3", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "SFPL", "name": "_"}, {"code": "mo.md(r\"\"\"\n## The Three-Layer Stack\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502               APPLICATION LAYER                     \u2502\n\u2502   ActorMesh[T] - Your training code as typed actors \u2502\n\u2502   Example: trainer.train.call(batch).get()          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502              COORDINATION LAYER                     \u2502\n\u2502   ProcMesh - Manages process lifecycle, ranks       \u2502\n\u2502   HostMesh - Manages host lifecycle, resources      \u2502\n\u2502   Example: host_mesh.spawn_procs(name=\"run_1\")      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502               BOOT LAYER                            \u2502\n\u2502   Bootstrap - Config serialization via env vars     \u2502\n\u2502   Channel - Async message transport (hyperactor)    \u2502\n\u2502   Safety: pdeathsig ensures no orphaned processes   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n```\n\n**Code pattern:**\n\n```python\nfrom monarch.job import SlurmJob\n\n# Coordination layer - allocate hosts (slow, once)\njob = SlurmJob(meshes={\"workers\": 4}, gpus_per_node=8)\njob.apply()\nhost_mesh = job.state().workers\n\n# Spawn processes (fast)\nproc_mesh = host_mesh.spawn_procs(per_host={\"gpus\": 8})\n\n# Application layer\ntrainers = proc_mesh.spawn(\"trainer\", TrainerActor)      # Instant\ntrainers.train.call(dataset).get()                       # Your code\n\n# Iterate without re-allocating - spawn new procs on same hosts\nproc_mesh_2 = host_mesh.spawn_procs(per_host={\"gpus\": 8})  # Fast!\n```\n\"\"\")", "code_hash": "31abdb12c2614b82964e5a10785a1ab7", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "BYtC", "name": "_"}, {"code": "mo.md(r\"\"\"\n## The Simple API: `this_host()`\n\nThe bootstrap demo above used internal APIs to show the mechanics.\nFor actual development, Monarch provides a simpler interface: `this_host()`.\n\nThis gives you a local host that can spawn multiple processes - same pattern,\ncleaner API. This is how we'll run all our examples in this presentation.\n\"\"\")", "code_hash": "58e19a53986f0250ce1f7e434e41f89a", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "RGSE", "name": "_"}, {"code": "class Worker(Actor):\n    \"\"\"A simple worker that knows its rank.\"\"\"\n\n    def __init__(self):\n        self.rank = current_rank().rank\n        print(f\"Worker initialized on rank {self.rank}\")\n\n    @endpoint\n    def compute(self, data: torch.Tensor) -\u003E dict:\n        \"\"\"Do some computation and return info about this worker.\"\"\"\n        result = data.sum().item() * (self.rank + 1)\n        return {\n            \"rank\": self.rank,\n            \"input_shape\": tuple(data.shape),\n            \"result\": result,\n        }\n\n# Spawn 4 worker processes locally\nhost = this_host()\nprocs = host.spawn_procs(per_host={\"gpus\": 4})\nworkers = procs.spawn(\"workers\", Worker)\n\nprint(\"\\n=== Calling all workers ===\")\n# Call all workers with the same data\ndata = torch.randn(10, 10)\nresults = workers.compute.call(data).get()\n\nfor _point, _result in results.items():\n    print(f\"Worker {_result['rank']}: computed {_result['result']:.2f}\")", "code_hash": "df434257e45b7d13a56ea338902598e0", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Kclp", "name": "_"}, {"code": "mo.md(r\"\"\"\n## Working with Individual Actors\n\nWhen you spawn actors on a mesh, you get an ActorMesh.\nYou can slice it to talk to individual actors or subsets.\n\"\"\")", "code_hash": "13d11fb04a6137ee23996792dc7c817b", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "emfo", "name": "_"}, {"code": "# Using workers from previous cell\n\n# Call all workers\nall_results = workers.compute.call(torch.ones(5, 5)).get()\nprint(f\"All workers returned: {list(all_results.values())}\")\n\n# Call just worker 0\nworker_0 = workers.slice(gpus=0)\nresult_0 = worker_0.compute.call_one(torch.ones(5, 5)).get()\nprint(f\"Worker 0 alone: {result_0}\")\n\n# Call workers 1 and 2\nsubset = workers.slice(gpus=slice(1, 3))\nsubset_results = subset.compute.call(torch.ones(5, 5)).get()\nprint(f\"Workers 1-2 returned: {list(subset_results.values())}\")", "code_hash": "9975b77af645a854ba0f7307c776fec0", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Hstk", "name": "_"}, {"code": "mo.md(r\"\"\"\n## All Logs in One Place\n\nWhen actors print, their output is aggregated back to your controller.\nNo more SSH-ing into nodes to check logs!\n\"\"\")", "code_hash": "506b28b486d103e44c615d31c2f71a1c", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "nWHF", "name": "_"}, {"code": "import time\n\nclass VerboseWorker(Actor):\n    def __init__(self):\n        self.rank = current_rank().rank\n        print(f\"[Rank {self.rank}] Initializing...\")\n\n    @endpoint\n    def do_work(self, task_id: int) -\u003E str:\n        print(f\"[Rank {self.rank}] Starting task {task_id}\")\n        time.sleep(0.1 * (self.rank + 1))  # Simulate varying work\n        print(f\"[Rank {self.rank}] Completed task {task_id}\")\n        return f\"rank_{self.rank}_task_{task_id}\"\n\n# Spawn workers\nverbose_procs = this_host().spawn_procs(per_host={\"gpus\": 3})\nverbose_workers = verbose_procs.spawn(\"verbose\", VerboseWorker)\n\nprint(\"\\n=== Running tasks ===\")\n# All workers work on the same task - watch the interleaved logs!\nverbose_results = verbose_workers.do_work.call(42).get()\n\nprint(\"\\n=== Results ===\")\nfor _point, _result in verbose_results.items():\n    print(f\"  {_result}\")", "code_hash": "7f3da34a52287733f40e10bf3e8ae5ca", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "iLit", "name": "_"}, {"code": "mo.md(r\"\"\"\n## When Things Go Wrong\n\nErrors from remote actors are brought back to your controller with full tracebacks.\n\"\"\")", "code_hash": "5470baf37a4802591812c83243fd6a48", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "ZHCJ", "name": "_"}, {"code": "class FlakyWorker(Actor):\n    def __init__(self):\n        self.rank = current_rank().rank\n\n    @endpoint\n    def risky_operation(self, fail_on_rank: int) -\u003E str:\n        if self.rank == fail_on_rank:\n            raise ValueError(f\"Intentional failure on rank {self.rank}!\")\n        return f\"success on rank {self.rank}\"\n\nflaky_procs = this_host().spawn_procs(per_host={\"gpus\": 3})\nflaky_workers = flaky_procs.spawn(\"flaky\", FlakyWorker)\n\n# This will fail on rank 1\ntry:\n    flaky_results = flaky_workers.risky_operation.call(1).get()\nexcept Exception as e:\n    print(f\"Caught error: {type(e).__name__}\")\n    print(f\"Message: {e}\")", "code_hash": "a62ac62677370da60956c0ad07144f08", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "ROlb", "name": "_"}, {"code": "mo.md(r\"\"\"\n## Putting It Together\n\nThe Monarch development workflow:\n\n1. **Start session**: `this_host().spawn_procs()` (or allocate real hosts)\n2. **Write actor code**: Define your `Actor` classes with `@endpoint` methods\n3. **Spawn and test**: `procs.spawn(\"name\", MyActor)` then call endpoints\n4. **See errors immediately**: Full tracebacks in your terminal\n5. **Fix and respawn**: No queue wait, no reallocation\n\nThis is what we mean by \"interactive distributed development.\"\n\"\"\")", "code_hash": "7824432c929ff2d612f31730044ab53d", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "qnkX", "name": "_"}, {"code": "mo.md(r\"\"\"\n## Summary\n\n**Key takeaways:**\n\n1. **Decouple allocation from iteration**: Allocate hosts once, spawn fast\n2. **Three-layer stack**: Boot \u2192 Coordination \u2192 Application\n3. **`this_host()`**: Local development with the same patterns as real clusters\n4. **Mesh operations**: `call()`, `slice()`, `call_one()` for flexible actor interaction\n5. **Aggregated everything**: Logs and errors come back to you\n\n**Next:** Fault Tolerance - what happens when things go wrong at scale\n\"\"\")", "code_hash": "10ae73123cdb4719433972614115d30c", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "TqIu", "name": "_"}, {"code": "mo.md(r\"\"\"\n---\n\n**TODO:** Live demo of `monarch run`\n\"\"\")", "code_hash": "ea86b3e24356993fda1dee2793b323ec", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Vxnm", "name": "_"}], "metadata": {"marimo_version": "0.19.7"}, "version": "1"},
            "session": {"cells": [{"code_hash": "1d0db38904205bec4d6f6f6a1f6cec3e", "console": [], "id": "Hbol", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "63abb5b605f7bd4eaf3c855c8ec14f10", "console": [], "id": "MJUe", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "a1e87fbb5d6c400a44e7d1a656e32dcc", "console": [], "id": "vblA", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch1 id=\"interactive-devx-monarch-as-remote-torchrun\"\u003EInteractive DevX: Monarch as Remote Torchrun\u003C/h1\u003E\n\u003Cspan class=\"paragraph\"\u003EWhat you'll learn:\u003C/span\u003E\n\u003Col\u003E\n\u003Cli\u003EThe pain of traditional distributed development (sbatch \u2192 wait \u2192 debug \u2192 repeat)\u003C/li\u003E\n\u003Cli\u003ESPMDJob as \"remote torchrun\" - allocate once, iterate fast\u003C/li\u003E\n\u003Cli\u003EThe three-layer stack: Boot \u2192 Coordination \u2192 Application\u003C/li\u003E\n\u003Cli\u003ERunning distributed programs interactively with \u003Ccode\u003Ethis_host()\u003C/code\u003E\u003C/li\u003E\n\u003C/ol\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "9169ca43ef6104f4fd6d2a54b9bc768a", "console": [], "id": "bkHC", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"the-pain-of-traditional-development\"\u003EThe Pain of Traditional Development\u003C/h2\u003E\n\u003Cdiv class=\"language-scdoc codehilite\"\u003E\u003Cpre\u003E\u003Cspan\u003E\u003C/span\u003E\u003Ccode\u003ETraditional Distributed Development Loop:\n\nDeveloper                    SLURM                     Cluster\n    \u2502                          \u2502                          \u2502\n    \u251c\u2500\u2500 sbatch job.sh \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502                          \u2502\n    \u2502                          \u251c\u2500\u2500 queue... \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\n    \u2502                          \u2502   (minutes to hours)     \u2502\n    \u2502                          \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n    \u2502\u25c4\u2500\u2500 job started \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524                          \u2502\n    \u2502                          \u2502                          \u2502\n    \u2502   ...wait for completion...                         \u2502\n    \u2502                          \u2502                          \u2502\n    \u251c\u2500\u2500 cat slurm-*.out \u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502                          \u2502\n    \u2502\u25c4\u2500\u2500 scattered logs \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524                          \u2502\n    \u2502                          \u2502                          \u2502\n    \u2502   \u0026quot;Found bug on line 42\u0026quot;                            \u2502\n    \u2502                          \u2502                          \u2502\n    \u2514\u2500\u2500 sbatch again... \u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502   (repeat forever)       \u2502\n\u003C/code\u003E\u003C/pre\u003E\u003C/div\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003EKey problems:\u003C/strong\u003E\u003C/span\u003E\n\u003Cul\u003E\n\u003Cli\u003EQueue wait time dominates iteration time\u003C/li\u003E\n\u003Cli\u003ELogs scattered across nodes\u003C/li\u003E\n\u003Cli\u003EEach fix requires full resubmission\u003C/li\u003E\n\u003Cli\u003ENo interactive debugging\u003C/li\u003E\n\u003C/ul\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "4465359d2dedfe2494b1b2a3dc810353", "console": [], "id": "lEQa", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"the-monarch-solution\"\u003EThe Monarch Solution\u003C/h2\u003E\n\u003Cdiv class=\"language-verilog codehilite\"\u003E\u003Cpre\u003E\u003Cspan\u003E\u003C/span\u003E\u003Ccode\u003E\u003Cspan class=\"n\"\u003EMonarch\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003EDevelopment\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"nl\"\u003ELoop:\u003C/span\u003E\n\n\u003Cspan class=\"n\"\u003EDeveloper\u003C/span\u003E\u003Cspan class=\"w\"\u003E                    \u003C/span\u003E\u003Cspan class=\"n\"\u003EMonarch\u003C/span\u003E\u003Cspan class=\"w\"\u003E                   \u003C/span\u003E\u003Cspan class=\"n\"\u003ECluster\u003C/span\u003E\n\u003Cspan class=\"w\"\u003E    \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\u003Cspan class=\"w\"\u003E                          \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\u003Cspan class=\"w\"\u003E                          \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n\u003Cspan class=\"w\"\u003E    \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u251c\u2500\u2500\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Eallocate\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Ehosts\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\u003C/span\u003E\u003Cspan class=\"w\"\u003E                          \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n\u003Cspan class=\"w\"\u003E    \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\u003Cspan class=\"w\"\u003E   \u003C/span\u003E\u003Cspan class=\"p\"\u003E(\u003C/span\u003E\u003Cspan class=\"n\"\u003Eone\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"kt\"\u003Etime\u003C/span\u003E\u003Cspan class=\"p\"\u003E,\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Eslow\u003C/span\u003E\u003Cspan class=\"p\"\u003E)\u003C/span\u003E\u003Cspan class=\"w\"\u003E       \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u251c\u2500\u2500\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Egang\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Eschedule\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\u003C/span\u003E\n\u003Cspan class=\"w\"\u003E    \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\u003Cspan class=\"w\"\u003E                          \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\u003C/span\u003E\n\u003Cspan class=\"w\"\u003E    \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u25c4\u2500\u2500\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003EHostMesh\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Eready\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\u003C/span\u003E\u003Cspan class=\"w\"\u003E                          \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n\u003Cspan class=\"w\"\u003E    \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\u003Cspan class=\"w\"\u003E                          \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\u003Cspan class=\"w\"\u003E                          \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n\u003Cspan class=\"w\"\u003E    \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\u003Cspan class=\"w\"\u003E   \u003C/span\u003E\u003Cspan class=\"o\"\u003E===\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003EFast\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Eiteration\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Eloop\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E===\u003C/span\u003E\u003Cspan class=\"w\"\u003E                       \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n\u003Cspan class=\"w\"\u003E    \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\u003Cspan class=\"w\"\u003E                          \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\u003Cspan class=\"w\"\u003E                          \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n\u003Cspan class=\"w\"\u003E    \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u251c\u2500\u2500\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Espawn_procs\u003C/span\u003E\u003Cspan class=\"p\"\u003E()\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\u003C/span\u003E\u003Cspan class=\"w\"\u003E   \u003C/span\u003E\u003Cspan class=\"p\"\u003E(\u003C/span\u003E\u003Cspan class=\"n\"\u003Einstant\u003C/span\u003E\u003Cspan class=\"p\"\u003E)\u003C/span\u003E\u003Cspan class=\"w\"\u003E              \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n\u003Cspan class=\"w\"\u003E    \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u251c\u2500\u2500\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Espawn\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Eactors\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\u003C/span\u003E\u003Cspan class=\"w\"\u003E   \u003C/span\u003E\u003Cspan class=\"p\"\u003E(\u003C/span\u003E\u003Cspan class=\"n\"\u003Einstant\u003C/span\u003E\u003Cspan class=\"p\"\u003E)\u003C/span\u003E\u003Cspan class=\"w\"\u003E              \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n\u003Cspan class=\"w\"\u003E    \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u251c\u2500\u2500\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Ecall\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Eendpoints\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\u003C/span\u003E\u003Cspan class=\"w\"\u003E   \u003C/span\u003E\u003Cspan class=\"p\"\u003E(\u003C/span\u003E\u003Cspan class=\"n\"\u003Einstant\u003C/span\u003E\u003Cspan class=\"p\"\u003E)\u003C/span\u003E\u003Cspan class=\"w\"\u003E              \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n\u003Cspan class=\"w\"\u003E    \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u25c4\u2500\u2500\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Eaggregated\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Elogs\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2500\u2500\u2500\u2500\u2500\u2500\u2524\u003C/span\u003E\u003Cspan class=\"w\"\u003E                          \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n\u003Cspan class=\"w\"\u003E    \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\u003Cspan class=\"w\"\u003E                          \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\u003Cspan class=\"w\"\u003E                          \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n\u003Cspan class=\"w\"\u003E    \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\u003Cspan class=\"w\"\u003E   \u003C/span\u003E\u003Cspan class=\"s\"\u003E\u0026quot;Found bug, fixing...\u0026quot;\u003C/span\u003E\u003Cspan class=\"w\"\u003E                            \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n\u003Cspan class=\"w\"\u003E    \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\u003Cspan class=\"w\"\u003E                          \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\u003Cspan class=\"w\"\u003E                          \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n\u003Cspan class=\"w\"\u003E    \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u251c\u2500\u2500\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Espawn_procs\u003C/span\u003E\u003Cspan class=\"p\"\u003E()\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Eagain\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2500\u2500\u25ba\u2502\u003C/span\u003E\u003Cspan class=\"w\"\u003E   \u003C/span\u003E\u003Cspan class=\"p\"\u003E(\u003C/span\u003E\u003Cspan class=\"n\"\u003Einstant\u003C/span\u003E\u003Cspan class=\"p\"\u003E,\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Esame\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Ehosts\u003C/span\u003E\u003Cspan class=\"o\"\u003E!\u003C/span\u003E\u003Cspan class=\"p\"\u003E)\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n\u003Cspan class=\"w\"\u003E    \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2514\u2500\u2500\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"p\"\u003E...\u003C/span\u003E\u003Cspan class=\"w\"\u003E                    \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\u003Cspan class=\"w\"\u003E                          \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n\u003C/code\u003E\u003C/pre\u003E\u003C/div\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003EKey insight:\u003C/strong\u003E Allocation is slow, but spawning on existing hosts is fast.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "8507148544e6f8be1281603b8caad3d2", "console": [], "id": "PKri", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"whats-really-happening-under-the-hood\"\u003EWhat's Really Happening Under the Hood\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003EWhen you call \u003Ccode\u003ESlurmJob(meshes={\"trainers\": 4}).apply()\u003C/code\u003E, here's what actually happens:\u003C/span\u003E\n\u003Cdiv class=\"language-python codehilite\"\u003E\u003Cpre\u003E\u003Cspan\u003E\u003C/span\u003E\u003Ccode\u003E\u003Cspan class=\"mf\"\u003E1.\u003C/span\u003E \u003Cspan class=\"n\"\u003EJob\u003C/span\u003E \u003Cspan class=\"n\"\u003ESubmission\u003C/span\u003E\u003Cspan class=\"p\"\u003E:\u003C/span\u003E \u003Cspan class=\"n\"\u003EMonarch\u003C/span\u003E \u003Cspan class=\"n\"\u003Esubmits\u003C/span\u003E \u003Cspan class=\"n\"\u003Ean\u003C/span\u003E \u003Cspan class=\"n\"\u003Esbatch\u003C/span\u003E \u003Cspan class=\"n\"\u003Escript\u003C/span\u003E \u003Cspan class=\"n\"\u003Eto\u003C/span\u003E \u003Cspan class=\"n\"\u003ESLURM\u003C/span\u003E\n   \u003Cspan class=\"err\"\u003E\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u003C/span\u003E\n   \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E  \u003Cspan class=\"c1\"\u003E#!/bin/bash                                               \u2502\u003C/span\u003E\n   \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E  \u003Cspan class=\"c1\"\u003E#SBATCH --nodes=4                                         \u2502\u003C/span\u003E\n   \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E  \u003Cspan class=\"n\"\u003Esrun\u003C/span\u003E \u003Cspan class=\"n\"\u003Epython\u003C/span\u003E \u003Cspan class=\"o\"\u003E-\u003C/span\u003E\u003Cspan class=\"n\"\u003Ec\u003C/span\u003E \u003Cspan class=\"s1\"\u003E\u0026#39;from monarch.actor import                 \u2502\u003C/span\u003E\n   \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E       \u003Cspan class=\"n\"\u003Erun_worker_loop_forever\u003C/span\u003E\u003Cspan class=\"p\"\u003E;\u003C/span\u003E                             \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n   \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E       \u003Cspan class=\"n\"\u003Erun_worker_loop_forever\u003C/span\u003E\u003Cspan class=\"p\"\u003E(\u003C/span\u003E                             \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n   \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E           \u003Cspan class=\"n\"\u003Eaddress\u003C/span\u003E\u003Cspan class=\"o\"\u003E=\u003C/span\u003E\u003Cspan class=\"s2\"\u003E\u0026quot;tcp://$(hostname):22222\u0026quot;\u003C/span\u003E\u003Cspan class=\"p\"\u003E,\u003C/span\u003E               \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n   \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E           \u003Cspan class=\"n\"\u003Eca\u003C/span\u003E\u003Cspan class=\"o\"\u003E=\u003C/span\u003E\u003Cspan class=\"s2\"\u003E\u0026quot;trust_all_connections\u0026quot;\u003C/span\u003E\u003Cspan class=\"p\"\u003E)\u003C/span\u003E\u003Cspan class=\"s1\"\u003E\u0026#39;                     \u2502\u003C/span\u003E\n   \u003Cspan class=\"err\"\u003E\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u003C/span\u003E\n\n\u003Cspan class=\"mf\"\u003E2.\u003C/span\u003E \u003Cspan class=\"n\"\u003EWorker\u003C/span\u003E \u003Cspan class=\"n\"\u003EStartup\u003C/span\u003E\u003Cspan class=\"p\"\u003E:\u003C/span\u003E \u003Cspan class=\"n\"\u003EEach\u003C/span\u003E \u003Cspan class=\"n\"\u003Enode\u003C/span\u003E \u003Cspan class=\"n\"\u003Eruns\u003C/span\u003E \u003Cspan class=\"n\"\u003Erun_worker_loop_forever\u003C/span\u003E\n   \u003Cspan class=\"err\"\u003E\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u003C/span\u003E  \u003Cspan class=\"err\"\u003E\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u003C/span\u003E  \u003Cspan class=\"err\"\u003E\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u003C/span\u003E  \u003Cspan class=\"err\"\u003E\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u003C/span\u003E\n   \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E  \u003Cspan class=\"n\"\u003ENode\u003C/span\u003E \u003Cspan class=\"mi\"\u003E0\u003C/span\u003E  \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E  \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E  \u003Cspan class=\"n\"\u003ENode\u003C/span\u003E \u003Cspan class=\"mi\"\u003E1\u003C/span\u003E  \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E  \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E  \u003Cspan class=\"n\"\u003ENode\u003C/span\u003E \u003Cspan class=\"mi\"\u003E2\u003C/span\u003E  \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E  \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E  \u003Cspan class=\"n\"\u003ENode\u003C/span\u003E \u003Cspan class=\"mi\"\u003E3\u003C/span\u003E  \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n   \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E  \u003Cspan class=\"p\"\u003E:\u003C/span\u003E\u003Cspan class=\"mi\"\u003E22222\u003C/span\u003E  \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E  \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E  \u003Cspan class=\"p\"\u003E:\u003C/span\u003E\u003Cspan class=\"mi\"\u003E22222\u003C/span\u003E  \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E  \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E  \u003Cspan class=\"p\"\u003E:\u003C/span\u003E\u003Cspan class=\"mi\"\u003E22222\u003C/span\u003E  \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E  \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E  \u003Cspan class=\"p\"\u003E:\u003C/span\u003E\u003Cspan class=\"mi\"\u003E22222\u003C/span\u003E  \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n   \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E \u003Cspan class=\"n\"\u003Ewaiting\u003C/span\u003E  \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E  \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E \u003Cspan class=\"n\"\u003Ewaiting\u003C/span\u003E  \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E  \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E \u003Cspan class=\"n\"\u003Ewaiting\u003C/span\u003E  \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E  \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E \u003Cspan class=\"n\"\u003Ewaiting\u003C/span\u003E  \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n   \u003Cspan class=\"err\"\u003E\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u003C/span\u003E  \u003Cspan class=\"err\"\u003E\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u003C/span\u003E  \u003Cspan class=\"err\"\u003E\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u003C/span\u003E  \u003Cspan class=\"err\"\u003E\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u003C/span\u003E\n\n\u003Cspan class=\"mf\"\u003E3.\u003C/span\u003E \u003Cspan class=\"n\"\u003EClient\u003C/span\u003E \u003Cspan class=\"n\"\u003EConnection\u003C/span\u003E\u003Cspan class=\"p\"\u003E:\u003C/span\u003E \u003Cspan class=\"n\"\u003Ejob\u003C/span\u003E\u003Cspan class=\"o\"\u003E.\u003C/span\u003E\u003Cspan class=\"n\"\u003Estate\u003C/span\u003E\u003Cspan class=\"p\"\u003E()\u003C/span\u003E \u003Cspan class=\"n\"\u003Ecalls\u003C/span\u003E \u003Cspan class=\"n\"\u003Eattach_to_workers\u003C/span\u003E\u003Cspan class=\"p\"\u003E(\u003C/span\u003E\u003Cspan class=\"o\"\u003E...\u003C/span\u003E\u003Cspan class=\"p\"\u003E)\u003C/span\u003E\n   \u003Cspan class=\"err\"\u003E\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u003C/span\u003E\n   \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E  \u003Cspan class=\"n\"\u003EYour\u003C/span\u003E \u003Cspan class=\"n\"\u003Enotebook\u003C/span\u003E \u003Cspan class=\"o\"\u003E/\u003C/span\u003E \u003Cspan class=\"n\"\u003Escript\u003C/span\u003E                                 \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n   \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E                                                         \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n   \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E  \u003Cspan class=\"n\"\u003Ehost_mesh\u003C/span\u003E \u003Cspan class=\"o\"\u003E=\u003C/span\u003E \u003Cspan class=\"n\"\u003Eattach_to_workers\u003C/span\u003E\u003Cspan class=\"p\"\u003E(\u003C/span\u003E                         \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n   \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E      \u003Cspan class=\"n\"\u003Eworkers\u003C/span\u003E\u003Cspan class=\"o\"\u003E=\u003C/span\u003E\u003Cspan class=\"p\"\u003E[\u003C/span\u003E\u003Cspan class=\"s2\"\u003E\u0026quot;tcp://node0:22222\u0026quot;\u003C/span\u003E\u003Cspan class=\"p\"\u003E,\u003C/span\u003E \u003Cspan class=\"s2\"\u003E\u0026quot;tcp://node1:22222\u0026quot;\u003C/span\u003E\u003Cspan class=\"p\"\u003E,\u003C/span\u003E \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n   \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E               \u003Cspan class=\"s2\"\u003E\u0026quot;tcp://node2:22222\u0026quot;\u003C/span\u003E\u003Cspan class=\"p\"\u003E,\u003C/span\u003E \u003Cspan class=\"s2\"\u003E\u0026quot;tcp://node3:22222\u0026quot;\u003C/span\u003E\u003Cspan class=\"p\"\u003E],\u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n   \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E      \u003Cspan class=\"n\"\u003Eca\u003C/span\u003E\u003Cspan class=\"o\"\u003E=\u003C/span\u003E\u003Cspan class=\"s2\"\u003E\u0026quot;trust_all_connections\u0026quot;\u003C/span\u003E                         \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n   \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E  \u003Cspan class=\"p\"\u003E)\u003C/span\u003E                                                      \u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n   \u003Cspan class=\"err\"\u003E\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u003C/span\u003E\n\u003C/code\u003E\u003C/pre\u003E\u003C/div\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003EThe key insight: Workers are just servers waiting for work.\u003C/strong\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EThe scheduler (SLURM, Kubernetes, etc.) handles launching them.\nThe client (your notebook/script) connects and orchestrates.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "364404bf96b00883fe029e381c4416c2", "console": [], "id": "Xref", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch3 id=\"live-demo-workers-as-servers\"\u003ELive Demo: Workers as Servers\u003C/h3\u003E\n\u003Cspan class=\"paragraph\"\u003ELet's see this in action. We'll use \u003Ccode\u003Ecreate_local_host_mesh\u003C/code\u003E which spawns\nworker processes locally - exactly what SlurmJob does on a real cluster.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "c5ba37c58eb339ddc316a4daacfc97e3", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "Creating host mesh with 3 workers...\n", "type": "stream"}, {"mimetype": "text/plain", "name": "stderr", "text": "Monarch internal logs are being written to /tmp/allencwang/monarch_log.log; execution id allencwang_Feb-03_15:14_561\n", "type": "stream"}, {"mimetype": "text/plain", "name": "stdout", "text": "Host mesh created - workers are now listening!\n\n\nCalling whoami() on all actors:\n", "type": "stream"}, {"mimetype": "text/plain", "name": "stderr", "text": "Monarch internal logs are being written to /tmp/allencwang/monarch_log.log; execution id allencwang_Feb-03_15:14_561\nMonarch internal logs are being written to /tmp/allencwang/monarch_log.log; execution id allencwang_Feb-03_15:14_561\nMonarch internal logs are being written to /tmp/allencwang/monarch_log.log; execution id allencwang_Feb-03_15:14_561\n", "type": "stream"}, {"mimetype": "text/plain", "name": "stdout", "text": "[BootstrapDemo] Actor initialized on rank 0\n[BootstrapDemo] Actor initialized on rank 1\n[BootstrapDemo] Actor initialized on rank 2\n  {'hosts': 0/3, 'gpus': 0/1}: rank=0\n  {'hosts': 1/3, 'gpus': 0/1}: rank=1\n  {'hosts': 2/3, 'gpus': 0/1}: rank=2\n", "type": "stream"}], "id": "SFPL", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "31abdb12c2614b82964e5a10785a1ab7", "console": [], "id": "BYtC", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"the-three-layer-stack\"\u003EThe Three-Layer Stack\u003C/h2\u003E\n\u003Cdiv class=\"language-tsql codehilite\"\u003E\u003Cpre\u003E\u003Cspan\u003E\u003C/span\u003E\u003Ccode\u003E\u003Cspan class=\"err\"\u003E\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u003C/span\u003E\n\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\u003Cspan class=\"w\"\u003E               \u003C/span\u003E\u003Cspan class=\"n\"\u003EAPPLICATION\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003ELAYER\u003C/span\u003E\u003Cspan class=\"w\"\u003E                     \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\u003Cspan class=\"w\"\u003E   \u003C/span\u003E\u003Cspan class=\"n\"\u003EActorMesh\u003C/span\u003E\u003Cspan class=\"o\"\u003E[\u003C/span\u003E\u003Cspan class=\"n\"\u003ET\u003C/span\u003E\u003Cspan class=\"o\"\u003E]\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E-\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003EYour\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Etraining\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Ecode\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"k\"\u003Eas\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Etyped\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Eactors\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\u003Cspan class=\"w\"\u003E   \u003C/span\u003E\u003Cspan class=\"nl\"\u003EExample\u003C/span\u003E\u003Cspan class=\"p\"\u003E:\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Etrainer\u003C/span\u003E\u003Cspan class=\"p\"\u003E.\u003C/span\u003E\u003Cspan class=\"n\"\u003Etrain\u003C/span\u003E\u003Cspan class=\"p\"\u003E.\u003C/span\u003E\u003Cspan class=\"k\"\u003Ecall\u003C/span\u003E\u003Cspan class=\"p\"\u003E(\u003C/span\u003E\u003Cspan class=\"n\"\u003Ebatch\u003C/span\u003E\u003Cspan class=\"p\"\u003E).\u003C/span\u003E\u003Cspan class=\"k\"\u003Eget\u003C/span\u003E\u003Cspan class=\"p\"\u003E()\u003C/span\u003E\u003Cspan class=\"w\"\u003E          \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n\u003Cspan class=\"err\"\u003E\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\u003C/span\u003E\n\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\u003Cspan class=\"w\"\u003E              \u003C/span\u003E\u003Cspan class=\"n\"\u003ECOORDINATION\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003ELAYER\u003C/span\u003E\u003Cspan class=\"w\"\u003E                     \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\u003Cspan class=\"w\"\u003E   \u003C/span\u003E\u003Cspan class=\"n\"\u003EProcMesh\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E-\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003EManages\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Eprocess\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Elifecycle\u003C/span\u003E\u003Cspan class=\"p\"\u003E,\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Eranks\u003C/span\u003E\u003Cspan class=\"w\"\u003E       \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\u003Cspan class=\"w\"\u003E   \u003C/span\u003E\u003Cspan class=\"n\"\u003EHostMesh\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E-\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003EManages\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"k\"\u003Ehost\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Elifecycle\u003C/span\u003E\u003Cspan class=\"p\"\u003E,\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Eresources\u003C/span\u003E\u003Cspan class=\"w\"\u003E      \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\u003Cspan class=\"w\"\u003E   \u003C/span\u003E\u003Cspan class=\"nl\"\u003EExample\u003C/span\u003E\u003Cspan class=\"p\"\u003E:\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Ehost_mesh\u003C/span\u003E\u003Cspan class=\"p\"\u003E.\u003C/span\u003E\u003Cspan class=\"n\"\u003Espawn_procs\u003C/span\u003E\u003Cspan class=\"p\"\u003E(\u003C/span\u003E\u003Cspan class=\"n\"\u003Ename\u003C/span\u003E\u003Cspan class=\"o\"\u003E=\u003C/span\u003E\u003Cspan class=\"ss\"\u003E\u0026quot;run_1\u0026quot;\u003C/span\u003E\u003Cspan class=\"p\"\u003E)\u003C/span\u003E\u003Cspan class=\"w\"\u003E      \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n\u003Cspan class=\"err\"\u003E\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\u003C/span\u003E\n\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\u003Cspan class=\"w\"\u003E               \u003C/span\u003E\u003Cspan class=\"n\"\u003EBOOT\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003ELAYER\u003C/span\u003E\u003Cspan class=\"w\"\u003E                            \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\u003Cspan class=\"w\"\u003E   \u003C/span\u003E\u003Cspan class=\"n\"\u003EBootstrap\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E-\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003EConfig\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Eserialization\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Evia\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Eenv\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Evars\u003C/span\u003E\u003Cspan class=\"w\"\u003E     \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\u003Cspan class=\"w\"\u003E   \u003C/span\u003E\u003Cspan class=\"n\"\u003EChannel\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"o\"\u003E-\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003EAsync\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Emessage\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Etransport\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"p\"\u003E(\u003C/span\u003E\u003Cspan class=\"n\"\u003Ehyperactor\u003C/span\u003E\u003Cspan class=\"p\"\u003E)\u003C/span\u003E\u003Cspan class=\"w\"\u003E    \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\u003Cspan class=\"w\"\u003E   \u003C/span\u003E\u003Cspan class=\"nl\"\u003ESafety\u003C/span\u003E\u003Cspan class=\"p\"\u003E:\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Epdeathsig\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Eensures\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"k\"\u003Eno\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Eorphaned\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"n\"\u003Eprocesses\u003C/span\u003E\u003Cspan class=\"w\"\u003E   \u003C/span\u003E\u003Cspan class=\"err\"\u003E\u2502\u003C/span\u003E\n\u003Cspan class=\"err\"\u003E\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u003C/span\u003E\n\u003C/code\u003E\u003C/pre\u003E\u003C/div\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003ECode pattern:\u003C/strong\u003E\u003C/span\u003E\n\u003Cdiv class=\"language-python codehilite\"\u003E\u003Cpre\u003E\u003Cspan\u003E\u003C/span\u003E\u003Ccode\u003E\u003Cspan class=\"kn\"\u003Efrom\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"nn\"\u003Emonarch.job\u003C/span\u003E\u003Cspan class=\"w\"\u003E \u003C/span\u003E\u003Cspan class=\"kn\"\u003Eimport\u003C/span\u003E \u003Cspan class=\"n\"\u003ESlurmJob\u003C/span\u003E\n\n\u003Cspan class=\"c1\"\u003E# Coordination layer - allocate hosts (slow, once)\u003C/span\u003E\n\u003Cspan class=\"n\"\u003Ejob\u003C/span\u003E \u003Cspan class=\"o\"\u003E=\u003C/span\u003E \u003Cspan class=\"n\"\u003ESlurmJob\u003C/span\u003E\u003Cspan class=\"p\"\u003E(\u003C/span\u003E\u003Cspan class=\"n\"\u003Emeshes\u003C/span\u003E\u003Cspan class=\"o\"\u003E=\u003C/span\u003E\u003Cspan class=\"p\"\u003E{\u003C/span\u003E\u003Cspan class=\"s2\"\u003E\u0026quot;workers\u0026quot;\u003C/span\u003E\u003Cspan class=\"p\"\u003E:\u003C/span\u003E \u003Cspan class=\"mi\"\u003E4\u003C/span\u003E\u003Cspan class=\"p\"\u003E},\u003C/span\u003E \u003Cspan class=\"n\"\u003Egpus_per_node\u003C/span\u003E\u003Cspan class=\"o\"\u003E=\u003C/span\u003E\u003Cspan class=\"mi\"\u003E8\u003C/span\u003E\u003Cspan class=\"p\"\u003E)\u003C/span\u003E\n\u003Cspan class=\"n\"\u003Ejob\u003C/span\u003E\u003Cspan class=\"o\"\u003E.\u003C/span\u003E\u003Cspan class=\"n\"\u003Eapply\u003C/span\u003E\u003Cspan class=\"p\"\u003E()\u003C/span\u003E\n\u003Cspan class=\"n\"\u003Ehost_mesh\u003C/span\u003E \u003Cspan class=\"o\"\u003E=\u003C/span\u003E \u003Cspan class=\"n\"\u003Ejob\u003C/span\u003E\u003Cspan class=\"o\"\u003E.\u003C/span\u003E\u003Cspan class=\"n\"\u003Estate\u003C/span\u003E\u003Cspan class=\"p\"\u003E()\u003C/span\u003E\u003Cspan class=\"o\"\u003E.\u003C/span\u003E\u003Cspan class=\"n\"\u003Eworkers\u003C/span\u003E\n\n\u003Cspan class=\"c1\"\u003E# Spawn processes (fast)\u003C/span\u003E\n\u003Cspan class=\"n\"\u003Eproc_mesh\u003C/span\u003E \u003Cspan class=\"o\"\u003E=\u003C/span\u003E \u003Cspan class=\"n\"\u003Ehost_mesh\u003C/span\u003E\u003Cspan class=\"o\"\u003E.\u003C/span\u003E\u003Cspan class=\"n\"\u003Espawn_procs\u003C/span\u003E\u003Cspan class=\"p\"\u003E(\u003C/span\u003E\u003Cspan class=\"n\"\u003Eper_host\u003C/span\u003E\u003Cspan class=\"o\"\u003E=\u003C/span\u003E\u003Cspan class=\"p\"\u003E{\u003C/span\u003E\u003Cspan class=\"s2\"\u003E\u0026quot;gpus\u0026quot;\u003C/span\u003E\u003Cspan class=\"p\"\u003E:\u003C/span\u003E \u003Cspan class=\"mi\"\u003E8\u003C/span\u003E\u003Cspan class=\"p\"\u003E})\u003C/span\u003E\n\n\u003Cspan class=\"c1\"\u003E# Application layer\u003C/span\u003E\n\u003Cspan class=\"n\"\u003Etrainers\u003C/span\u003E \u003Cspan class=\"o\"\u003E=\u003C/span\u003E \u003Cspan class=\"n\"\u003Eproc_mesh\u003C/span\u003E\u003Cspan class=\"o\"\u003E.\u003C/span\u003E\u003Cspan class=\"n\"\u003Espawn\u003C/span\u003E\u003Cspan class=\"p\"\u003E(\u003C/span\u003E\u003Cspan class=\"s2\"\u003E\u0026quot;trainer\u0026quot;\u003C/span\u003E\u003Cspan class=\"p\"\u003E,\u003C/span\u003E \u003Cspan class=\"n\"\u003ETrainerActor\u003C/span\u003E\u003Cspan class=\"p\"\u003E)\u003C/span\u003E      \u003Cspan class=\"c1\"\u003E# Instant\u003C/span\u003E\n\u003Cspan class=\"n\"\u003Etrainers\u003C/span\u003E\u003Cspan class=\"o\"\u003E.\u003C/span\u003E\u003Cspan class=\"n\"\u003Etrain\u003C/span\u003E\u003Cspan class=\"o\"\u003E.\u003C/span\u003E\u003Cspan class=\"n\"\u003Ecall\u003C/span\u003E\u003Cspan class=\"p\"\u003E(\u003C/span\u003E\u003Cspan class=\"n\"\u003Edataset\u003C/span\u003E\u003Cspan class=\"p\"\u003E)\u003C/span\u003E\u003Cspan class=\"o\"\u003E.\u003C/span\u003E\u003Cspan class=\"n\"\u003Eget\u003C/span\u003E\u003Cspan class=\"p\"\u003E()\u003C/span\u003E                       \u003Cspan class=\"c1\"\u003E# Your code\u003C/span\u003E\n\n\u003Cspan class=\"c1\"\u003E# Iterate without re-allocating - spawn new procs on same hosts\u003C/span\u003E\n\u003Cspan class=\"n\"\u003Eproc_mesh_2\u003C/span\u003E \u003Cspan class=\"o\"\u003E=\u003C/span\u003E \u003Cspan class=\"n\"\u003Ehost_mesh\u003C/span\u003E\u003Cspan class=\"o\"\u003E.\u003C/span\u003E\u003Cspan class=\"n\"\u003Espawn_procs\u003C/span\u003E\u003Cspan class=\"p\"\u003E(\u003C/span\u003E\u003Cspan class=\"n\"\u003Eper_host\u003C/span\u003E\u003Cspan class=\"o\"\u003E=\u003C/span\u003E\u003Cspan class=\"p\"\u003E{\u003C/span\u003E\u003Cspan class=\"s2\"\u003E\u0026quot;gpus\u0026quot;\u003C/span\u003E\u003Cspan class=\"p\"\u003E:\u003C/span\u003E \u003Cspan class=\"mi\"\u003E8\u003C/span\u003E\u003Cspan class=\"p\"\u003E})\u003C/span\u003E  \u003Cspan class=\"c1\"\u003E# Fast!\u003C/span\u003E\n\u003C/code\u003E\u003C/pre\u003E\u003C/div\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "58e19a53986f0250ce1f7e434e41f89a", "console": [], "id": "RGSE", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"the-simple-api-this_host\"\u003EThe Simple API: \u003Ccode\u003Ethis_host()\u003C/code\u003E\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003EThe bootstrap demo above used internal APIs to show the mechanics.\nFor actual development, Monarch provides a simpler interface: \u003Ccode\u003Ethis_host()\u003C/code\u003E.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EThis gives you a local host that can spawn multiple processes - same pattern,\ncleaner API. This is how we'll run all our examples in this presentation.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "df434257e45b7d13a56ea338902598e0", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "\n=== Calling all workers ===\nWorker initialized on rank 2\nWorker initialized on rank 3\nWorker initialized on rank 1\nWorker initialized on rank 0\nWorker 0: computed 3.40\nWorker 1: computed 6.81\nWorker 2: computed 10.21\nWorker 3: computed 13.62\n", "type": "stream"}], "id": "Kclp", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "13d11fb04a6137ee23996792dc7c817b", "console": [], "id": "emfo", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"working-with-individual-actors\"\u003EWorking with Individual Actors\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003EWhen you spawn actors on a mesh, you get an ActorMesh.\nYou can slice it to talk to individual actors or subsets.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "9975b77af645a854ba0f7307c776fec0", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "All workers returned: [{'rank': 0, 'input_shape': (5, 5), 'result': 25.0}, {'rank': 1, 'input_shape': (5, 5), 'result': 50.0}, {'rank': 2, 'input_shape': (5, 5), 'result': 75.0}, {'rank': 3, 'input_shape': (5, 5), 'result': 100.0}]\nWorker 0 alone: {'rank': 0, 'input_shape': (5, 5), 'result': 25.0}\nWorkers 1-2 returned: [{'rank': 1, 'input_shape': (5, 5), 'result': 50.0}, {'rank': 2, 'input_shape': (5, 5), 'result': 75.0}]\n", "type": "stream"}], "id": "Hstk", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "506b28b486d103e44c615d31c2f71a1c", "console": [], "id": "nWHF", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"all-logs-in-one-place\"\u003EAll Logs in One Place\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003EWhen actors print, their output is aggregated back to your controller.\nNo more SSH-ing into nodes to check logs!\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "7f3da34a52287733f40e10bf3e8ae5ca", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "\n=== Running tasks ===\n[Rank 2] Initializing...\n[Rank 2] Starting task 42\n[Rank 1] Initializing...\n[Rank 1] Starting task 42\n[Rank 0] Initializing...\n[Rank 0] Starting task 42\n[Rank 0] Completed task 42\n[Rank 1] Completed task 42\n[Rank 2] Completed task 42\n\n=== Results ===\n  rank_0_task_42\n  rank_1_task_42\n  rank_2_task_42\n", "type": "stream"}], "id": "iLit", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "5470baf37a4802591812c83243fd6a48", "console": [], "id": "ZHCJ", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"when-things-go-wrong\"\u003EWhen Things Go Wrong\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003EErrors from remote actors are brought back to your controller with full tracebacks.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "a62ac62677370da60956c0ad07144f08", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "Caught error: ActorError\nMessage: Actor call flaky.risky_operation failed.\n Traceback of where the remote call failed (most recent call last):\n  File \"/home/allencwang/forge-dev/smol_projects/monarch-gpu-mode/.venv/lib/python3.12/site-packages/monarch/_src/actor/actor_mesh.py\", line 1384, in handle\n    result = the_method(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/tmp/marimo_1317316/__marimo__cell_ROlb_.py\", line 8, in risky_operation\n    raise ValueError(f\"Intentional failure on rank {self.rank}!\")\nValueError: Intentional failure on rank 1!\n\n", "type": "stream"}], "id": "ROlb", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "7824432c929ff2d612f31730044ab53d", "console": [], "id": "qnkX", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"putting-it-together\"\u003EPutting It Together\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003EThe Monarch development workflow:\u003C/span\u003E\n\u003Col\u003E\n\u003Cli\u003E\u003Cstrong\u003EStart session\u003C/strong\u003E: \u003Ccode\u003Ethis_host().spawn_procs()\u003C/code\u003E (or allocate real hosts)\u003C/li\u003E\n\u003Cli\u003E\u003Cstrong\u003EWrite actor code\u003C/strong\u003E: Define your \u003Ccode\u003EActor\u003C/code\u003E classes with \u003Ccode\u003E@endpoint\u003C/code\u003E methods\u003C/li\u003E\n\u003Cli\u003E\u003Cstrong\u003ESpawn and test\u003C/strong\u003E: \u003Ccode\u003Eprocs.spawn(\"name\", MyActor)\u003C/code\u003E then call endpoints\u003C/li\u003E\n\u003Cli\u003E\u003Cstrong\u003ESee errors immediately\u003C/strong\u003E: Full tracebacks in your terminal\u003C/li\u003E\n\u003Cli\u003E\u003Cstrong\u003EFix and respawn\u003C/strong\u003E: No queue wait, no reallocation\u003C/li\u003E\n\u003C/ol\u003E\n\u003Cspan class=\"paragraph\"\u003EThis is what we mean by \"interactive distributed development.\"\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "10ae73123cdb4719433972614115d30c", "console": [], "id": "TqIu", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"summary\"\u003ESummary\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003EKey takeaways:\u003C/strong\u003E\u003C/span\u003E\n\u003Col\u003E\n\u003Cli\u003E\u003Cstrong\u003EDecouple allocation from iteration\u003C/strong\u003E: Allocate hosts once, spawn fast\u003C/li\u003E\n\u003Cli\u003E\u003Cstrong\u003EThree-layer stack\u003C/strong\u003E: Boot \u2192 Coordination \u2192 Application\u003C/li\u003E\n\u003Cli\u003E\u003Cstrong\u003E\u003Ccode\u003Ethis_host()\u003C/code\u003E\u003C/strong\u003E: Local development with the same patterns as real clusters\u003C/li\u003E\n\u003Cli\u003E\u003Cstrong\u003EMesh operations\u003C/strong\u003E: \u003Ccode\u003Ecall()\u003C/code\u003E, \u003Ccode\u003Eslice()\u003C/code\u003E, \u003Ccode\u003Ecall_one()\u003C/code\u003E for flexible actor interaction\u003C/li\u003E\n\u003Cli\u003E\u003Cstrong\u003EAggregated everything\u003C/strong\u003E: Logs and errors come back to you\u003C/li\u003E\n\u003C/ol\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003ENext:\u003C/strong\u003E Fault Tolerance - what happens when things go wrong at scale\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "ea86b3e24356993fda1dee2793b323ec", "console": [], "id": "Vxnm", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Chr /\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003ETODO:\u003C/strong\u003E Live demo of \u003Ccode\u003Emonarch run\u003C/code\u003E\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}], "metadata": {"marimo_version": "0.19.7"}, "version": "1"},
            "runtimeConfig": null,
        };
    </script>
  
<marimo-code hidden="">
    import%20marimo%0A%0A__generated_with%20%3D%20%220.19.7%22%0Aapp%20%3D%20marimo.App(width%3D%22medium%22)%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20import%20marimo%20as%20mo%0A%20%20%20%20return%20(mo%2C)%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20%23%20Shared%20imports%20for%20the%20notebook%0A%20%20%20%20import%20sys%0A%20%20%20%20import%20torch%0A%20%20%20%20from%20monarch.actor%20import%20Actor%2C%20endpoint%2C%20current_rank%2C%20this_host%0A%20%20%20%20return%20Actor%2C%20current_rank%2C%20endpoint%2C%20sys%2C%20this_host%2C%20torch%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%20Interactive%20DevX%3A%20Monarch%20as%20Remote%20Torchrun%0A%0A%20%20%20%20What%20you'll%20learn%3A%0A%0A%20%20%20%201.%20The%20pain%20of%20traditional%20distributed%20development%20(sbatch%20%E2%86%92%20wait%20%E2%86%92%20debug%20%E2%86%92%20repeat)%0A%20%20%20%202.%20SPMDJob%20as%20%22remote%20torchrun%22%20-%20allocate%20once%2C%20iterate%20fast%0A%20%20%20%203.%20The%20three-layer%20stack%3A%20Boot%20%E2%86%92%20Coordination%20%E2%86%92%20Application%0A%20%20%20%204.%20Running%20distributed%20programs%20interactively%20with%20%60this_host()%60%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%20The%20Pain%20of%20Traditional%20Development%0A%0A%20%20%20%20%60%60%60%0A%20%20%20%20Traditional%20Distributed%20Development%20Loop%3A%0A%0A%20%20%20%20Developer%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20SLURM%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Cluster%0A%20%20%20%20%20%20%20%20%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20sbatch%20job.sh%20%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%96%BA%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%20%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20queue...%20%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%96%BA%0A%20%20%20%20%20%20%20%20%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%20%20%20(minutes%20to%20hours)%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%20%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%E2%97%84%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%A4%0A%20%20%20%20%20%20%20%20%E2%94%82%E2%97%84%E2%94%80%E2%94%80%20job%20started%20%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%A4%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%20%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%20%E2%94%82%20%20%20...wait%20for%20completion...%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%20%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20cat%20slurm-*.out%20%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%96%BA%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%20%E2%94%82%E2%97%84%E2%94%80%E2%94%80%20scattered%20logs%20%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%A4%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%20%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%20%E2%94%82%20%20%20%22Found%20bug%20on%20line%2042%22%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%20%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%20%E2%94%94%E2%94%80%E2%94%80%20sbatch%20again...%20%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%96%BA%E2%94%82%20%20%20(repeat%20forever)%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%60%60%60%0A%0A%20%20%20%20**Key%20problems%3A**%0A%0A%20%20%20%20-%20Queue%20wait%20time%20dominates%20iteration%20time%0A%20%20%20%20-%20Logs%20scattered%20across%20nodes%0A%20%20%20%20-%20Each%20fix%20requires%20full%20resubmission%0A%20%20%20%20-%20No%20interactive%20debugging%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%20The%20Monarch%20Solution%0A%0A%20%20%20%20%60%60%60%0A%20%20%20%20Monarch%20Development%20Loop%3A%0A%0A%20%20%20%20Developer%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Monarch%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Cluster%0A%20%20%20%20%20%20%20%20%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20allocate%20hosts%20%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%96%BA%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%20%E2%94%82%20%20%20(one%20time%2C%20slow)%20%20%20%20%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20gang%20schedule%20%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%96%BA%E2%94%82%0A%20%20%20%20%20%20%20%20%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%E2%97%84%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%A4%0A%20%20%20%20%20%20%20%20%E2%94%82%E2%97%84%E2%94%80%E2%94%80%20HostMesh%20ready%20%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%A4%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%20%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%20%E2%94%82%20%20%20%3D%3D%3D%20Fast%20iteration%20loop%20%3D%3D%3D%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%20%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20spawn_procs()%20%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%96%BA%E2%94%82%20%20%20(instant)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20spawn%20actors%20%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%96%BA%E2%94%82%20%20%20(instant)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20call%20endpoints%20%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%96%BA%E2%94%82%20%20%20(instant)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%20%E2%94%82%E2%97%84%E2%94%80%E2%94%80%20aggregated%20logs%20%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%A4%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%20%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%20%E2%94%82%20%20%20%22Found%20bug%2C%20fixing...%22%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%20%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20spawn_procs()%20again%20%E2%94%80%E2%94%80%E2%96%BA%E2%94%82%20%20%20(instant%2C%20same%20hosts!)%20%E2%94%82%0A%20%20%20%20%20%20%20%20%E2%94%94%E2%94%80%E2%94%80%20...%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%60%60%60%0A%0A%20%20%20%20**Key%20insight%3A**%20Allocation%20is%20slow%2C%20but%20spawning%20on%20existing%20hosts%20is%20fast.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%20What's%20Really%20Happening%20Under%20the%20Hood%0A%0A%20%20%20%20When%20you%20call%20%60SlurmJob(meshes%3D%7B%22trainers%22%3A%204%7D).apply()%60%2C%20here's%20what%20actually%20happens%3A%0A%0A%20%20%20%20%60%60%60%0A%20%20%20%201.%20Job%20Submission%3A%20Monarch%20submits%20an%20sbatch%20script%20to%20SLURM%0A%20%20%20%20%20%20%20%E2%94%8C%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%90%0A%20%20%20%20%20%20%20%E2%94%82%20%20%23!%2Fbin%2Fbash%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%E2%94%82%20%20%23SBATCH%20--nodes%3D4%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%E2%94%82%20%20srun%20python%20-c%20'from%20monarch.actor%20import%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%E2%94%82%20%20%20%20%20%20%20run_worker_loop_forever%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%E2%94%82%20%20%20%20%20%20%20run_worker_loop_forever(%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%E2%94%82%20%20%20%20%20%20%20%20%20%20%20address%3D%22tcp%3A%2F%2F%24(hostname)%3A22222%22%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%E2%94%82%20%20%20%20%20%20%20%20%20%20%20ca%3D%22trust_all_connections%22)'%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%E2%94%94%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%98%0A%0A%20%20%20%202.%20Worker%20Startup%3A%20Each%20node%20runs%20run_worker_loop_forever%0A%20%20%20%20%20%20%20%E2%94%8C%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%90%20%20%E2%94%8C%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%90%20%20%E2%94%8C%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%90%20%20%E2%94%8C%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%90%0A%20%20%20%20%20%20%20%E2%94%82%20%20Node%200%20%20%E2%94%82%20%20%E2%94%82%20%20Node%201%20%20%E2%94%82%20%20%E2%94%82%20%20Node%202%20%20%E2%94%82%20%20%E2%94%82%20%20Node%203%20%20%E2%94%82%0A%20%20%20%20%20%20%20%E2%94%82%20%20%3A22222%20%20%E2%94%82%20%20%E2%94%82%20%20%3A22222%20%20%E2%94%82%20%20%E2%94%82%20%20%3A22222%20%20%E2%94%82%20%20%E2%94%82%20%20%3A22222%20%20%E2%94%82%0A%20%20%20%20%20%20%20%E2%94%82%20waiting%20%20%E2%94%82%20%20%E2%94%82%20waiting%20%20%E2%94%82%20%20%E2%94%82%20waiting%20%20%E2%94%82%20%20%E2%94%82%20waiting%20%20%E2%94%82%0A%20%20%20%20%20%20%20%E2%94%94%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%98%20%20%E2%94%94%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%98%20%20%E2%94%94%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%98%20%20%E2%94%94%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%98%0A%0A%20%20%20%203.%20Client%20Connection%3A%20job.state()%20calls%20attach_to_workers(...)%0A%20%20%20%20%20%20%20%E2%94%8C%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%90%0A%20%20%20%20%20%20%20%E2%94%82%20%20Your%20notebook%20%2F%20script%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%E2%94%82%20%20host_mesh%20%3D%20attach_to_workers(%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%E2%94%82%20%20%20%20%20%20workers%3D%5B%22tcp%3A%2F%2Fnode0%3A22222%22%2C%20%22tcp%3A%2F%2Fnode1%3A22222%22%2C%20%E2%94%82%0A%20%20%20%20%20%20%20%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22tcp%3A%2F%2Fnode2%3A22222%22%2C%20%22tcp%3A%2F%2Fnode3%3A22222%22%5D%2C%E2%94%82%0A%20%20%20%20%20%20%20%E2%94%82%20%20%20%20%20%20ca%3D%22trust_all_connections%22%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%E2%94%82%20%20)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%20%20%20%E2%94%94%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%98%0A%20%20%20%20%60%60%60%0A%0A%20%20%20%20**The%20key%20insight%3A%20Workers%20are%20just%20servers%20waiting%20for%20work.**%0A%0A%20%20%20%20The%20scheduler%20(SLURM%2C%20Kubernetes%2C%20etc.)%20handles%20launching%20them.%0A%20%20%20%20The%20client%20(your%20notebook%2Fscript)%20connects%20and%20orchestrates.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%23%20Live%20Demo%3A%20Workers%20as%20Servers%0A%0A%20%20%20%20Let's%20see%20this%20in%20action.%20We'll%20use%20%60create_local_host_mesh%60%20which%20spawns%0A%20%20%20%20worker%20processes%20locally%20-%20exactly%20what%20SlurmJob%20does%20on%20a%20real%20cluster.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(Actor%2C%20current_rank%2C%20endpoint%2C%20sys)%3A%0A%20%20%20%20from%20monarch._src.actor.host_mesh%20import%20create_local_host_mesh%0A%20%20%20%20from%20monarch._src.actor.endpoint%20import%20Extent%0A%0A%20%20%20%20class%20BootstrapDemo(Actor)%3A%0A%20%20%20%20%20%20%20%20%22%22%22Actor%20that%20reports%20where%20it's%20running.%22%22%22%0A%0A%20%20%20%20%20%20%20%20def%20__init__(self)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20self.rank%20%3D%20current_rank().rank%0A%20%20%20%20%20%20%20%20%20%20%20%20print(f%22%5BBootstrapDemo%5D%20Actor%20initialized%20on%20rank%20%7Bself.rank%7D%22)%0A%0A%20%20%20%20%20%20%20%20%40endpoint%0A%20%20%20%20%20%20%20%20def%20whoami(self)%20-%3E%20dict%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20%7B%22rank%22%3A%20self.rank%2C%20%22python%22%3A%20sys.executable%7D%0A%0A%20%20%20%20%23%20This%20simulates%20what%20SlurmJob%20does%3A%0A%20%20%20%20%23%201.%20Spawn%20worker%20processes%20(like%20run_worker_loop_forever%20on%20each%20node)%0A%20%20%20%20%23%202.%20Connect%20to%20them%20(like%20attach_to_workers)%0A%20%20%20%20%23%203.%20Return%20a%20HostMesh%0A%20%20%20%20print(%22Creating%20host%20mesh%20with%203%20workers...%22)%0A%20%20%20%20demo_host_mesh%20%3D%20create_local_host_mesh(%0A%20%20%20%20%20%20%20%20extent%3DExtent(%5B%22hosts%22%5D%2C%20%5B3%5D)%2C%0A%20%20%20%20%20%20%20%20env%3D%7B%22PYTHONPATH%22%3A%20%22%3A%22.join(sys.path)%7D%2C%0A%20%20%20%20)%0A%20%20%20%20print(%22Host%20mesh%20created%20-%20workers%20are%20now%20listening!%5Cn%22)%0A%0A%20%20%20%20%23%20Spawn%20processes%20and%20actors%0A%20%20%20%20demo_procs%20%3D%20demo_host_mesh.spawn_procs(per_host%3D%7B%22gpus%22%3A%201%7D)%0A%20%20%20%20demo_actors%20%3D%20demo_procs.spawn(%22bootstrap_demo%22%2C%20BootstrapDemo)%0A%0A%20%20%20%20%23%20Call%20all%20actors%0A%20%20%20%20print(%22%5CnCalling%20whoami()%20on%20all%20actors%3A%22)%0A%20%20%20%20demo_results%20%3D%20demo_actors.whoami.call().get()%0A%20%20%20%20for%20point%2C%20info%20in%20demo_results.items()%3A%0A%20%20%20%20%20%20%20%20print(f%22%20%20%7Bpoint%7D%3A%20rank%3D%7Binfo%5B'rank'%5D%7D%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%20The%20Three-Layer%20Stack%0A%0A%20%20%20%20%60%60%60%0A%20%20%20%20%E2%94%8C%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%90%0A%20%20%20%20%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20APPLICATION%20LAYER%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%E2%94%82%20%20%20ActorMesh%5BT%5D%20-%20Your%20training%20code%20as%20typed%20actors%20%E2%94%82%0A%20%20%20%20%E2%94%82%20%20%20Example%3A%20trainer.train.call(batch).get()%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%E2%94%9C%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%A4%0A%20%20%20%20%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%20%20%20COORDINATION%20LAYER%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%E2%94%82%20%20%20ProcMesh%20-%20Manages%20process%20lifecycle%2C%20ranks%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%E2%94%82%20%20%20HostMesh%20-%20Manages%20host%20lifecycle%2C%20resources%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%E2%94%82%20%20%20Example%3A%20host_mesh.spawn_procs(name%3D%22run_1%22)%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%E2%94%9C%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%A4%0A%20%20%20%20%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20BOOT%20LAYER%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%0A%20%20%20%20%E2%94%82%20%20%20Bootstrap%20-%20Config%20serialization%20via%20env%20vars%20%20%20%20%20%E2%94%82%0A%20%20%20%20%E2%94%82%20%20%20Channel%20-%20Async%20message%20transport%20(hyperactor)%20%20%20%20%E2%94%82%0A%20%20%20%20%E2%94%82%20%20%20Safety%3A%20pdeathsig%20ensures%20no%20orphaned%20processes%20%20%20%E2%94%82%0A%20%20%20%20%E2%94%94%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%80%E2%94%98%0A%20%20%20%20%60%60%60%0A%0A%20%20%20%20**Code%20pattern%3A**%0A%0A%20%20%20%20%60%60%60python%0A%20%20%20%20from%20monarch.job%20import%20SlurmJob%0A%0A%20%20%20%20%23%20Coordination%20layer%20-%20allocate%20hosts%20(slow%2C%20once)%0A%20%20%20%20job%20%3D%20SlurmJob(meshes%3D%7B%22workers%22%3A%204%7D%2C%20gpus_per_node%3D8)%0A%20%20%20%20job.apply()%0A%20%20%20%20host_mesh%20%3D%20job.state().workers%0A%0A%20%20%20%20%23%20Spawn%20processes%20(fast)%0A%20%20%20%20proc_mesh%20%3D%20host_mesh.spawn_procs(per_host%3D%7B%22gpus%22%3A%208%7D)%0A%0A%20%20%20%20%23%20Application%20layer%0A%20%20%20%20trainers%20%3D%20proc_mesh.spawn(%22trainer%22%2C%20TrainerActor)%20%20%20%20%20%20%23%20Instant%0A%20%20%20%20trainers.train.call(dataset).get()%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20Your%20code%0A%0A%20%20%20%20%23%20Iterate%20without%20re-allocating%20-%20spawn%20new%20procs%20on%20same%20hosts%0A%20%20%20%20proc_mesh_2%20%3D%20host_mesh.spawn_procs(per_host%3D%7B%22gpus%22%3A%208%7D)%20%20%23%20Fast!%0A%20%20%20%20%60%60%60%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%20The%20Simple%20API%3A%20%60this_host()%60%0A%0A%20%20%20%20The%20bootstrap%20demo%20above%20used%20internal%20APIs%20to%20show%20the%20mechanics.%0A%20%20%20%20For%20actual%20development%2C%20Monarch%20provides%20a%20simpler%20interface%3A%20%60this_host()%60.%0A%0A%20%20%20%20This%20gives%20you%20a%20local%20host%20that%20can%20spawn%20multiple%20processes%20-%20same%20pattern%2C%0A%20%20%20%20cleaner%20API.%20This%20is%20how%20we'll%20run%20all%20our%20examples%20in%20this%20presentation.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(Actor%2C%20current_rank%2C%20endpoint%2C%20this_host%2C%20torch)%3A%0A%20%20%20%20class%20Worker(Actor)%3A%0A%20%20%20%20%20%20%20%20%22%22%22A%20simple%20worker%20that%20knows%20its%20rank.%22%22%22%0A%0A%20%20%20%20%20%20%20%20def%20__init__(self)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20self.rank%20%3D%20current_rank().rank%0A%20%20%20%20%20%20%20%20%20%20%20%20print(f%22Worker%20initialized%20on%20rank%20%7Bself.rank%7D%22)%0A%0A%20%20%20%20%20%20%20%20%40endpoint%0A%20%20%20%20%20%20%20%20def%20compute(self%2C%20data%3A%20torch.Tensor)%20-%3E%20dict%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%22%22%22Do%20some%20computation%20and%20return%20info%20about%20this%20worker.%22%22%22%0A%20%20%20%20%20%20%20%20%20%20%20%20result%20%3D%20data.sum().item()%20*%20(self.rank%20%2B%201)%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22rank%22%3A%20self.rank%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22input_shape%22%3A%20tuple(data.shape)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22result%22%3A%20result%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%23%20Spawn%204%20worker%20processes%20locally%0A%20%20%20%20host%20%3D%20this_host()%0A%20%20%20%20procs%20%3D%20host.spawn_procs(per_host%3D%7B%22gpus%22%3A%204%7D)%0A%20%20%20%20workers%20%3D%20procs.spawn(%22workers%22%2C%20Worker)%0A%0A%20%20%20%20print(%22%5Cn%3D%3D%3D%20Calling%20all%20workers%20%3D%3D%3D%22)%0A%20%20%20%20%23%20Call%20all%20workers%20with%20the%20same%20data%0A%20%20%20%20data%20%3D%20torch.randn(10%2C%2010)%0A%20%20%20%20results%20%3D%20workers.compute.call(data).get()%0A%0A%20%20%20%20for%20_point%2C%20_result%20in%20results.items()%3A%0A%20%20%20%20%20%20%20%20print(f%22Worker%20%7B_result%5B'rank'%5D%7D%3A%20computed%20%7B_result%5B'result'%5D%3A.2f%7D%22)%0A%20%20%20%20return%20(workers%2C)%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%20Working%20with%20Individual%20Actors%0A%0A%20%20%20%20When%20you%20spawn%20actors%20on%20a%20mesh%2C%20you%20get%20an%20ActorMesh.%0A%20%20%20%20You%20can%20slice%20it%20to%20talk%20to%20individual%20actors%20or%20subsets.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(torch%2C%20workers)%3A%0A%20%20%20%20%23%20Using%20workers%20from%20previous%20cell%0A%0A%20%20%20%20%23%20Call%20all%20workers%0A%20%20%20%20all_results%20%3D%20workers.compute.call(torch.ones(5%2C%205)).get()%0A%20%20%20%20print(f%22All%20workers%20returned%3A%20%7Blist(all_results.values())%7D%22)%0A%0A%20%20%20%20%23%20Call%20just%20worker%200%0A%20%20%20%20worker_0%20%3D%20workers.slice(gpus%3D0)%0A%20%20%20%20result_0%20%3D%20worker_0.compute.call_one(torch.ones(5%2C%205)).get()%0A%20%20%20%20print(f%22Worker%200%20alone%3A%20%7Bresult_0%7D%22)%0A%0A%20%20%20%20%23%20Call%20workers%201%20and%202%0A%20%20%20%20subset%20%3D%20workers.slice(gpus%3Dslice(1%2C%203))%0A%20%20%20%20subset_results%20%3D%20subset.compute.call(torch.ones(5%2C%205)).get()%0A%20%20%20%20print(f%22Workers%201-2%20returned%3A%20%7Blist(subset_results.values())%7D%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%20All%20Logs%20in%20One%20Place%0A%0A%20%20%20%20When%20actors%20print%2C%20their%20output%20is%20aggregated%20back%20to%20your%20controller.%0A%20%20%20%20No%20more%20SSH-ing%20into%20nodes%20to%20check%20logs!%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(Actor%2C%20current_rank%2C%20endpoint%2C%20this_host)%3A%0A%20%20%20%20import%20time%0A%0A%20%20%20%20class%20VerboseWorker(Actor)%3A%0A%20%20%20%20%20%20%20%20def%20__init__(self)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20self.rank%20%3D%20current_rank().rank%0A%20%20%20%20%20%20%20%20%20%20%20%20print(f%22%5BRank%20%7Bself.rank%7D%5D%20Initializing...%22)%0A%0A%20%20%20%20%20%20%20%20%40endpoint%0A%20%20%20%20%20%20%20%20def%20do_work(self%2C%20task_id%3A%20int)%20-%3E%20str%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20print(f%22%5BRank%20%7Bself.rank%7D%5D%20Starting%20task%20%7Btask_id%7D%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20time.sleep(0.1%20*%20(self.rank%20%2B%201))%20%20%23%20Simulate%20varying%20work%0A%20%20%20%20%20%20%20%20%20%20%20%20print(f%22%5BRank%20%7Bself.rank%7D%5D%20Completed%20task%20%7Btask_id%7D%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20f%22rank_%7Bself.rank%7D_task_%7Btask_id%7D%22%0A%0A%20%20%20%20%23%20Spawn%20workers%0A%20%20%20%20verbose_procs%20%3D%20this_host().spawn_procs(per_host%3D%7B%22gpus%22%3A%203%7D)%0A%20%20%20%20verbose_workers%20%3D%20verbose_procs.spawn(%22verbose%22%2C%20VerboseWorker)%0A%0A%20%20%20%20print(%22%5Cn%3D%3D%3D%20Running%20tasks%20%3D%3D%3D%22)%0A%20%20%20%20%23%20All%20workers%20work%20on%20the%20same%20task%20-%20watch%20the%20interleaved%20logs!%0A%20%20%20%20verbose_results%20%3D%20verbose_workers.do_work.call(42).get()%0A%0A%20%20%20%20print(%22%5Cn%3D%3D%3D%20Results%20%3D%3D%3D%22)%0A%20%20%20%20for%20_point%2C%20_result%20in%20verbose_results.items()%3A%0A%20%20%20%20%20%20%20%20print(f%22%20%20%7B_result%7D%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%20When%20Things%20Go%20Wrong%0A%0A%20%20%20%20Errors%20from%20remote%20actors%20are%20brought%20back%20to%20your%20controller%20with%20full%20tracebacks.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(Actor%2C%20current_rank%2C%20endpoint%2C%20this_host)%3A%0A%20%20%20%20class%20FlakyWorker(Actor)%3A%0A%20%20%20%20%20%20%20%20def%20__init__(self)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20self.rank%20%3D%20current_rank().rank%0A%0A%20%20%20%20%20%20%20%20%40endpoint%0A%20%20%20%20%20%20%20%20def%20risky_operation(self%2C%20fail_on_rank%3A%20int)%20-%3E%20str%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20self.rank%20%3D%3D%20fail_on_rank%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20raise%20ValueError(f%22Intentional%20failure%20on%20rank%20%7Bself.rank%7D!%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20f%22success%20on%20rank%20%7Bself.rank%7D%22%0A%0A%20%20%20%20flaky_procs%20%3D%20this_host().spawn_procs(per_host%3D%7B%22gpus%22%3A%203%7D)%0A%20%20%20%20flaky_workers%20%3D%20flaky_procs.spawn(%22flaky%22%2C%20FlakyWorker)%0A%0A%20%20%20%20%23%20This%20will%20fail%20on%20rank%201%0A%20%20%20%20try%3A%0A%20%20%20%20%20%20%20%20flaky_results%20%3D%20flaky_workers.risky_operation.call(1).get()%0A%20%20%20%20except%20Exception%20as%20e%3A%0A%20%20%20%20%20%20%20%20print(f%22Caught%20error%3A%20%7Btype(e).__name__%7D%22)%0A%20%20%20%20%20%20%20%20print(f%22Message%3A%20%7Be%7D%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%20Putting%20It%20Together%0A%0A%20%20%20%20The%20Monarch%20development%20workflow%3A%0A%0A%20%20%20%201.%20**Start%20session**%3A%20%60this_host().spawn_procs()%60%20(or%20allocate%20real%20hosts)%0A%20%20%20%202.%20**Write%20actor%20code**%3A%20Define%20your%20%60Actor%60%20classes%20with%20%60%40endpoint%60%20methods%0A%20%20%20%203.%20**Spawn%20and%20test**%3A%20%60procs.spawn(%22name%22%2C%20MyActor)%60%20then%20call%20endpoints%0A%20%20%20%204.%20**See%20errors%20immediately**%3A%20Full%20tracebacks%20in%20your%20terminal%0A%20%20%20%205.%20**Fix%20and%20respawn**%3A%20No%20queue%20wait%2C%20no%20reallocation%0A%0A%20%20%20%20This%20is%20what%20we%20mean%20by%20%22interactive%20distributed%20development.%22%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%20Summary%0A%0A%20%20%20%20**Key%20takeaways%3A**%0A%0A%20%20%20%201.%20**Decouple%20allocation%20from%20iteration**%3A%20Allocate%20hosts%20once%2C%20spawn%20fast%0A%20%20%20%202.%20**Three-layer%20stack**%3A%20Boot%20%E2%86%92%20Coordination%20%E2%86%92%20Application%0A%20%20%20%203.%20**%60this_host()%60**%3A%20Local%20development%20with%20the%20same%20patterns%20as%20real%20clusters%0A%20%20%20%204.%20**Mesh%20operations**%3A%20%60call()%60%2C%20%60slice()%60%2C%20%60call_one()%60%20for%20flexible%20actor%20interaction%0A%20%20%20%205.%20**Aggregated%20everything**%3A%20Logs%20and%20errors%20come%20back%20to%20you%0A%0A%20%20%20%20**Next%3A**%20Fault%20Tolerance%20-%20what%20happens%20when%20things%20go%20wrong%20at%20scale%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20---%0A%0A%20%20%20%20**TODO%3A**%20Live%20demo%20of%20%60monarch%20run%60%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0Aif%20__name__%20%3D%3D%20%22__main__%22%3A%0A%20%20%20%20app.run()%0A
</marimo-code>

<marimo-code-hash hidden="">69a5461a132a0a21f5f0b285215df1be</marimo-code-hash>
</body>
</html>
